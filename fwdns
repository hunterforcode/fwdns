#!/usr/bin/env node
'use strict';

if (process.env.NODE_ENV !== 'production'){
  try { require('longjohn'); } catch (e) {} }

const debug = require('debug')('fwdns:server');
const dnsd = require('./dnsd/named');
const dns = require('./dns/dns');

function collectZone(zone, zones) {
  zone = require(zone);
  if (zone && Array.isArray(zone.hosts) && Array.isArray(zone.names)) {
    zones.push(zone);
  }
  return zones;
}

const option = require('commander')
  .version(require('./package.json').version)
  .option('-p, --port [6666]', 'Port to bind', val => parseInt(val), 6666)
  .option('-l, --listen [127.0.0.1]', 'Address to listen', '127.0.0.1')
  .option('-f, --forward-zone [/path/to/forward/zone.json]',
    'Forward zone setting, {"hosts": ["8.8.8.8"], "names": ["google.com"]}',
     collectZone, [])
  .option('-l, --local-zone [/path/to/local/zone.json]',
    'Local zone setting, {"hosts": ["127.0.0.1"], "names": ["abc.com"]}',
     collectZone, [])
  .parse(process.argv);

console.log(option.forwardZone);
